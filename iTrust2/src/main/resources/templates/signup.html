<html xmlns:th="http://www.thymeleaf.org"
	xmlns:tiles="http://www.thymeleaf.org">
<head>
<title tiles:fragment="title">iTrust2 :: Sign Up</title>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<style>
body {
	background-image: url("DrJenkins");
	background-size: cover;
}
</style>

<!-- AngularJS library -->
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
</head>
<body>
	<div tiles:fragment="content">
		<script type="text/javascript">
			function fillLoginFields(u, p) {
				document.getElementById("username").value = u;
				document.getElementById("password").value = p;
				document.forms[0].submit();
			}
		</script>
		<script th:inline="javascript">
			/* Otherwise Thymeleaf tries to parse Javascript as XML and breaks itself sometimes.  Sigh */
			/*<![CDATA[*/
			var app = angular.module("loginApp", []);

			app.controller('loginCtrl', function($scope, $http) {

				$scope.generateUsers = function(username, password, role) {
					var userData = {
						username: username,
						password: password,
						password2: password,
						roles: [role],
						enabled: 1,
					};

					console.log(userData);

					$http.post("api/v1/generateUsers", userData).then(function(success) {
						alert("User generated successfully");
						window.location.href = "login";

					}, function(failure) {
						alert("User generation failed. Please try again.");
					});
				}
			});
			/*]]>*/
		</script>

		<div class="container" ng-app="loginApp" ng-controller="loginCtrl">
			<div class="row">
				<div class="col-md-4 col-md-offset-4">
					<br />
					<div class="panel panel-default">
						<div class="panel-body" style="background: #eee">
							<h1>Signup to iTrust2</h1>
							<form name="f" ng-submit="generateUsers(username, password, role)">
								<fieldset>
									<div th:if="${param.error}" class="alert alert-error">
										Invalid username and password.</div>
										
									<div class="form-group">
										<label for="username">Username</label> <input type="text"
											class="form-control" id="username" name="username"
											placeholder="Username" ng-model="username">
									</div>
									<div class="form-group">
										<label for="password">Password</label> <input type="password"
											class="form-control" id="password" name="password"
											placeholder="Password" ng-model="password">
									</div>

									<div class="form-group">
										<label for="role">Role</label>
										<select class="form-control" id="role" name="role" ng-model="role">
											<option value="ROLE_PATIENT" selected>Patient</option>
											<option value="ROLE_HCP">Health Care Provider (HCP)</option>
											<option value="ROLE_OPH">Ophthalmologist HCP</option>
											<option value="ROLE_ADMIN">Admin</option>
											<option value="ROLE_ER">Emergency Responder (ER)</option>
											<option value="ROLE_LABTECH">Lab Tech</option>
										</select>
									</div>

									<button type="submit" class="btn btn-primary btn-block">Generate new user</button>
								</fieldset>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
